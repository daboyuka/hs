name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.22'
        
    - name: Download dependencies
      run: go mod download
      
    - name: Build binaries
      run: |
        mkdir -p release
        GOOS=linux  GOARCH=amd64 go build -o release/hs.linux
        GOOS=darwin GOARCH=amd64 go build -o release/hs.mac  
        GOOS=darwin GOARCH=arm64 go build -o release/hs.m1mac
        
    - name: Create Release
      run: |
        if [[ "${{ github.ref_name }}" == v0* ]]; then
          PRERELEASE_FLAG="--prerelease"
        else
          PRERELEASE_FLAG=""
        fi
        
        gh release create ${{ github.ref_name }} \
          release/hs.linux \
          release/hs.mac \
          release/hs.m1mac \
          --title "Release ${{ github.ref_name }}" \
          --generate-notes \
          $PRERELEASE_FLAG
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 
